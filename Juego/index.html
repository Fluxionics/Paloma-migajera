<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SelecciÃ³n de Mundo - Paloma Migajera</title>
    <link rel="stylesheet" href="style-juego.css">
</head>
<body>

    <div class="background-master">
        <img src="fondo.jpg" class="bg-img">
        <div class="vignette"></div>
        <div id="crumbs-container"></div>
    </div>

    <main class="ui-container">
        <div class="usuario-info-top">
            <span id="usuario-nombre">ğŸ‘¤ Usuario</span>
            <span id="usuario-dificultad" class="badge-dif">NORMAL</span>
        </div>

        <h2 class="fade-in">SELECCIÃ“N DE MUNDO</h2>
        
        <div class="mundos-wrapper" id="mundos-list">
            <!-- Se llena dinÃ¡micamente -->
        </div>

        <button class="back-btn fade-in" onclick="volverSeleccionUsuario()">
            â† CAMBIAR USUARIO
        </button>
    </main>

    <script src="../config.js"></script>
    <script src="../sistema-usuarios.js"></script>
    <script>
        // Crear migajas de pan cayendo
        function spawnCrumbs() {
            const container = document.getElementById('crumbs-container');
            for (let i = 0; i < 35; i++) {
                const crumb = document.createElement('div');
                crumb.className = 'crumb';
                crumb.style.left = Math.random() * 100 + 'vw';
                crumb.style.width = crumb.style.height = (Math.random() * 3 + 2) + 'px';
                crumb.style.animationDuration = (Math.random() * 3 + 4) + 's';
                crumb.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(crumb);
            }
        }

        function cargarMundos() {
            // Verificar que hay usuario
            if (!window.PALOMA_USUARIOS || !window.PALOMA_USUARIOS.usuarioActual) {
                window.location.href = '../seleccion-usuario.html';
                return;
            }

            const usuario = window.PALOMA_USUARIOS.usuarioActual;
            
            // Mostrar info del usuario
            document.getElementById('usuario-nombre').textContent = `ğŸ‘¤ ${usuario.username}`;
            document.getElementById('usuario-dificultad').textContent = usuario.dificultad.toUpperCase();
            document.getElementById('usuario-dificultad').className = `badge-dif ${usuario.dificultad}`;

            const container = document.getElementById('mundos-list');
            const mundos = usuario.mundos;
            
            container.innerHTML = '';
            
            Object.entries(mundos).forEach(([num, mundo], index) => {
                const card = document.createElement('div');
                card.className = `mundo-card fade-in ${mundo.desbloqueado ? 'desbloqueado' : 'bloqueado'} ${mundo.completado ? 'completado' : ''}`;
                card.style.animationDelay = (index * 0.15) + 's';
                
                const nombresMundos = {
                    1: 'El Despertar',
                    2: 'Calles de la Ciudad',
                    3: 'El Parque Central',
                    4: 'Los Techos',
                    5: 'Las Alcantarillas'
                };

                const iconosMundos = {
                    1: 'ğŸŒ…',
                    2: 'ğŸ™ï¸',
                    3: 'ğŸŒ³',
                    4: 'ğŸ ',
                    5: 'ğŸš°'
                };

                if (mundo.desbloqueado) {
                    card.innerHTML = `
                        <div class="mundo-icono">${iconosMundos[num]}</div>
                        <div class="mundo-numero">Mundo ${num}</div>
                        <div class="mundo-nombre">${nombresMundos[num]}</div>
                        <div class="mundo-status">
                            ${mundo.completado ? 'âœ… Completado' : 'ğŸ® Disponible'}
                        </div>
                        ${mundo.mejorTiempo ? `
                            <div class="mundo-tiempo">â±ï¸ Mejor: ${formatearTiempo(mundo.mejorTiempo)}</div>
                        ` : ''}
                        <button class="btn-jugar-mundo">JUGAR</button>
                    `;
                    
                    card.querySelector('.btn-jugar-mundo').onclick = () => iniciarMundo(num);
                } else {
                    card.innerHTML = `
                        <div class="mundo-icono bloqueado-icono">ğŸ”’</div>
                        <div class="mundo-numero">Mundo ${num}</div>
                        <div class="mundo-nombre">${nombresMundos[num]}</div>
                        <div class="mundo-status bloqueado-texto">
                            Bloqueado
                        </div>
                        <div class="mundo-requisito">
                            Completa el Mundo ${num - 1}
                        </div>
                    `;
                }
                
                container.appendChild(card);
            });
        }

        function iniciarMundo(numero) {
            // Guardar el mundo seleccionado
            localStorage.setItem('paloma_mundo_actual', numero);
            
            // Ir al gameplay
            window.location.href = 'Gameplay/index.html';
        }

        function volverSeleccionUsuario() {
            window.location.href = '../seleccion-usuario.html';
        }

        function formatearTiempo(minutos) {
            const horas = Math.floor(minutos / 60);
            const mins = Math.floor(minutos % 60);
            const segs = Math.floor((minutos % 1) * 60);
            
            if (horas > 0) {
                return `${horas}h ${mins}m ${segs}s`;
            } else if (mins > 0) {
                return `${mins}m ${segs}s`;
            } else {
                return `${segs}s`;
            }
        }

        window.onload = () => { 
            spawnCrumbs();
            cargarMundos();
        };
    </script>
</body>
</html>
