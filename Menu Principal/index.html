<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paloma Migajera</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="background-container">
        <img src="fondo.jpg" class="fondo-img" onerror="this.style.display='none';">
        <div class="vignette"></div>
    </div>

    <div class="main-layout">
        <h1 id="game-title" class="fade-in">CARGANDO...</h1>
        
        <nav class="menu-list">
            <button id="btn-continuar" class="menu-item fade-in" style="animation-delay: 0.3s; display: none;">
                CONTINUAR
            </button>
            <button class="menu-item fade-in" style="animation-delay: 0.5s;" onclick="window.location.href='../Juego/index.html'">
                INICIAR VUELO
            </button>
            <button class="menu-item fade-in" style="animation-delay: 0.7s;" onclick="window.location.href='../Ajustes/index.html'">
                AJUSTES
            </button>
            <button class="menu-item fade-in" style="animation-delay: 0.9s;" onclick="abrirCreditos()">
                CR√âDITOS
            </button>
            <button class="menu-item fade-in" style="animation-delay: 1.1s;" onclick="salirJuego()">
                SALIR
            </button>
        </nav>

        <div class="version-info fade-in" style="animation-delay: 1.2s;">
            <span id="game-version">v0.0.0</span>
        </div>
    </div>

    <!-- MODAL DE CR√âDITOS -->
    <div id="modal-creditos" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="cerrarCreditos()">&times;</span>
            <h2>üïäÔ∏è CR√âDITOS</h2>
            
            <div class="creditos-section">
                <h3>Desarrollo</h3>
                <p id="desarrolladores">Guillermo R. - Francisco D. - Daila J.</p>
            </div>

            <div class="creditos-section">
                <h3>Dise√±o y Arte</h3>
                <p>Pixel Art y Sprites: Francisco D. - Daila J.</p>
                <p>Dise√±o de Niveles: Francisco D. - Daila J.</p>
                <p>Logica del juego : Guillermo R.</p>
            </div>

            <div class="creditos-section">
                <h3>Inspiraci√≥n</h3>
                <p>Hollow Knight - Team Cherry</p>
                <p>Celeste - Maddy Makes Games</p>
            </div>

            <div class="creditos-section">
                <h3>Agradecimientos Especiales</h3>
                <p>A todos los jugadores que probaron las versiones Alpha</p>
                <p>A la comunidad de desarrollo indie</p>
            </div>

            <div class="creditos-version">
                <p id="version-creditos">Versi√≥n v1.0.2 - Alpha</p>
                <p>¬© 2024 Paloma Migajera</p>
            </div>

            <button class="btn-cerrar-modal" onclick="cerrarCreditos()">Volver al Men√∫</button>
        </div>
    </div>

    <!-- AUDIO (Preparado para cuando tengan los archivos) -->
    <!-- 
    <audio id="musica-menu" loop>
        <source src="audio/menu-theme.mp3" type="audio/mpeg">
        <source src="audio/menu-theme.ogg" type="audio/ogg">
    </audio>
    -->

    <script src="../config.js"></script>
    <script>
        // ========================================
        // INICIALIZACI√ìN DEL MEN√ö
        // ========================================
        
        // Configurar t√≠tulo y versi√≥n
        if (typeof gameConfig !== 'undefined') {
            document.getElementById('game-title').innerText = gameConfig.nombre || "PALOMA MIGAJERA";
            document.getElementById('game-version').innerText = `${gameConfig.version || "v1.0.0"} - ${gameConfig.estado || "Alpha"}`;
            
            // Actualizar cr√©ditos
            if (gameConfig.desarrollador) {
                document.getElementById('desarrolladores').innerText = gameConfig.desarrollador;
            }
            document.getElementById('version-creditos').innerText = 
                `Versi√≥n ${gameConfig.version || "v1.0.0"} - ${gameConfig.estado || "Alpha"}`;
        }

        // ========================================
        // SISTEMA DE CONTINUAR
        // ========================================
        
        window.addEventListener('DOMContentLoaded', () => {
            verificarPartidasGuardadas();
            inicializarAudio();
            agregarEfectosSonido();
        });

        function verificarPartidasGuardadas() {
            // Buscar la partida m√°s reciente
            let ultimaPartida = null;
            let fechaMasReciente = null;

            for (let i = 1; i <= 3; i++) {
                const data = localStorage.getItem(`paloma_save_${i}`);
                if (data) {
                    const save = JSON.parse(data);
                    const fechaPartida = new Date(save.fecha);
                    
                    if (!fechaMasReciente || fechaPartida > fechaMasReciente) {
                        fechaMasReciente = fechaPartida;
                        ultimaPartida = i;
                    }
                }
            }

            // Mostrar bot√≥n CONTINUAR si hay partidas
            if (ultimaPartida) {
                const btnContinuar = document.getElementById('btn-continuar');
                btnContinuar.style.display = 'block';
                btnContinuar.onclick = () => {
                    // Ir directamente al gameplay de la √∫ltima partida
                    localStorage.setItem('paloma_current_save', ultimaPartida);
                    window.location.href = '../Juego/Gameplay/index.html';
                };
            }
        }

        // ========================================
        // SISTEMA DE AUDIO (Preparado)
        // ========================================
        
        function inicializarAudio() {
            // Cuando tengan archivos de audio, descomentar esto:
            /*
            const musica = document.getElementById('musica-menu');
            const settings = JSON.parse(localStorage.getItem('paloma_settings'));
            
            if (settings && settings.audio) {
                musica.volume = settings.audio.musica / 100;
            }
            
            // Intentar reproducir (requiere interacci√≥n del usuario)
            document.body.addEventListener('click', () => {
                musica.play().catch(e => console.log('Audio bloqueado por el navegador'));
            }, { once: true });
            */
        }

        function agregarEfectosSonido() {
            const botones = document.querySelectorAll('.menu-item');
            
            botones.forEach(btn => {
                btn.addEventListener('mouseenter', () => {
                    // Placeholder para efecto de sonido al pasar el mouse
                    // reproducirSonido('hover');
                });
                
                btn.addEventListener('click', () => {
                    // Placeholder para efecto de sonido al hacer clic
                    // reproducirSonido('click');
                });
            });
        }

        function reproducirSonido(tipo) {
            // Cuando tengan archivos de audio:
            /*
            const settings = JSON.parse(localStorage.getItem('paloma_settings'));
            const volumen = settings ? settings.audio.efectos / 100 : 0.8;
            
            const audio = new Audio(`audio/${tipo}.mp3`);
            audio.volume = volumen;
            audio.play();
            */
            console.log(`üîä Reproducir sonido: ${tipo}`);
        }

        // ========================================
        // MODAL DE CR√âDITOS
        // ========================================
        
        function abrirCreditos() {
            const modal = document.getElementById('modal-creditos');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease-out';
            reproducirSonido('menu-open');
        }

        function cerrarCreditos() {
            const modal = document.getElementById('modal-creditos');
            modal.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            reproducirSonido('menu-close');
        }

        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = (event) => {
            const modal = document.getElementById('modal-creditos');
            if (event.target === modal) {
                cerrarCreditos();
            }
        };

        // ========================================
        // SALIR DEL JUEGO
        // ========================================
        
        function salirJuego() {
            if (confirm('¬øEst√°s seguro de que quieres salir?')) {
                // En una aplicaci√≥n real, esto cerrar√≠a la ventana
                // En navegador, redirige a una p√°gina de despedida
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; 
                                height: 100vh; background: black; color: white; 
                                flex-direction: column; font-family: 'Segoe UI', sans-serif;">
                        <h1 style="font-size: 3rem; font-weight: 200; letter-spacing: 8px; margin-bottom: 20px;">
                            ¬°HASTA PRONTO!
                        </h1>
                        <p style="font-size: 1.2rem; opacity: 0.7; letter-spacing: 2px;">
                            Gracias por jugar Paloma Migajera
                        </p>
                        <button onclick="window.location.reload()" 
                                style="margin-top: 40px; padding: 15px 40px; background: white; 
                                       color: black; border: none; cursor: pointer; font-size: 1rem;
                                       letter-spacing: 2px; border-radius: 3px;">
                            VOLVER AL MEN√ö
                        </button>
                    </div>
                `;
            }
        }

        // ========================================
        // ATAJOS DE TECLADO
        // ========================================
        
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Escape') {
                const modal = document.getElementById('modal-creditos');
                if (modal.style.display === 'flex') {
                    cerrarCreditos();
                }
            }
        });

        console.log('üïäÔ∏è Men√∫ Principal - Paloma Migajera cargado');
    </script>
</body>
</html>
